<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
   http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet  author="gleb"  id="TAG-STATE-0.67.0">
        <tagDatabase  tag="0.67.0"/>
    </changeSet>

    <changeSet author="gleb" id="CREATE-TABLE-series_item_types" >
        <createTable tableName="series_item_types">
            <column name="type_id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="series_item_types_pk"/>
            </column>
            <column name="name" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="gleb" id="ADD-SERIES-TYPE-BOOK">
        <insert tableName="series_item_types">
            <column  name="type_id"  value="0"/>
            <column  name="name"  value="BOOK"/>
        </insert>
        <rollback/>
    </changeSet>

    <changeSet author="gleb" id="ADD-SERIES-TYPE-MOVIE">
        <insert tableName="series_item_types">
            <column  name="type_id"  value="1"/>
            <column  name="name"  value="MOVIE"/>
        </insert>
        <rollback/>
    </changeSet>

    <changeSet author="gleb" id="ADD-SERIES-TYPE-GAME">
        <insert tableName="series_item_types">
            <column  name="type_id"  value="2"/>
            <column  name="name"  value="GAME"/>
        </insert>
        <rollback/>
    </changeSet>


    <changeSet author="gleb"  id="CREATE-SEQUENCE-backlog_item_id_seq">
        <createSequence
                cacheSize="1"
                cycle="false"
                incrementBy="1"
                maxValue="9223372036854775807"
                minValue="0"
                sequenceName="backlog_item_id_seq"
                startValue="0"
        />
    </changeSet>

    <changeSet author="gleb" id="CREATE-TABLE-backlog" >
        <createTable tableName="backlog">
            <column name="item_id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="backlog_pk"/>
            </column>
            <column name="user_user_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="type_type_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="note" type="TEXT"/>
            <column name="creation_date" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="gleb" id="ADD-FK-backlog.backlog_type_fk">
        <addForeignKeyConstraint
                baseTableName="backlog"
                baseColumnNames="type_type_id"
                referencedTableName="series_item_types"
                referencedColumnNames="type_id"
                constraintName="backlog_type_fk"
                deferrable="false"
                initiallyDeferred="false"
                onDelete="NO ACTION"
                onUpdate="NO ACTION"
        />
    </changeSet>

    <changeSet author="gleb" id="ADD-FK-backlog.backlog_user_fk">
        <addForeignKeyConstraint
                baseTableName="backlog"
                baseColumnNames="user_user_id"
                referencedTableName="users"
                referencedColumnNames="user_id"
                constraintName="backlog_user_fk"
                deferrable="false"
                initiallyDeferred="false"
                onDelete="NO ACTION"
                onUpdate="NO ACTION"
        />
    </changeSet>

</databaseChangeLog>