<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ru.rerumu.lists.mappers.GameMapper">

    <resultMap id="GameResultMap" type="ru.rerumu.lists.model.Game">
        <constructor>
            <arg column="title" name="title" javaType="String"/>
            <arg name="user" resultMap="UserResultMap"/>
            <arg column="create_date_utc" name="createDateUTC" javaType="java.time.LocalDateTime"/>
        </constructor>
    </resultMap>

    <resultMap id="UserResultMap" type="ru.rerumu.lists.model.User">
        <constructor>
            <arg column="user_id" name="userId" javaType="String"/>
            <arg column="name" name="name" javaType="String"/>
            <arg column="password" name="password" javaType="String"/>
        </constructor>
    </resultMap>

    <select id="findByUser" parameterType="ru.rerumu.lists.model.User" resultMap="BookTypeResultMap">
        select  g.title,
                u."USER_ID" as user_id,
                u.name,
                u.password,
                g.create_date_utc
        from    games g
                inner join users u
                            on u."USER_ID" = g.user_user_id
        where u.name=#{name}
    </select>

    <insert id="insert" parameterType="ru.rerumu.lists.model.Game">
        insert into games(game_id, user_user_id, title, insert_date)
        values(#{gameId},#{user.userId},#{title},#{createDateUTC})
    </insert>

    <select id="nextval">
        SELECT nextval('game_id_seq');
    </select>



</mapper>